networks:
  mg_net:
    external: true
    name: mg_net
secrets:
  pki.millegrilles.ssl.CAchain:
    external: true
    name: pki.millegrilles.ssl.CAchain.20190207
  pki.millegrilles.ssl.cert:
    external: true
    name: pki.millegrilles.ssl.cert.20190207
  pki.millegrilles.ssl.key:
    external: true
    name: pki.millegrilles.ssl.key.20190207
  pki.millegrilles.web.fullchain:
    external: true
    name: pki.millegrilles.web.fullchain.20190708
  pki.millegrilles.web.key:
    external: true
    name: pki.millegrilles.web.key.20190708
services:
  coupdoeilreact:
    deploy:
      placement:
        constraints:
        - node.labels.netzone.private == true
        - node.labels.millegrilles.coupdoeil == true
      replicas: 1
      resources:
        limits:
          cpus: '1.00'
          memory: 512M
      restart_policy:
        condition: any
        delay: 30s
    environment:
      CERT: /run/secrets/pki.millegrilles.web.fullchain
      MG_MQ_CAFILE: /run/secrets/pki.millegrilles.ssl.CAchain
      MG_MQ_CERTFILE: /run/secrets/pki.millegrilles.ssl.cert
      MG_MQ_KEYFILE: /run/secrets/pki.millegrilles.ssl.key
      MG_MQ_URL: amqps://mq:5673/maple
      MG_NOM_MILLEGRILLE: maple
      PRIVKEY: /run/secrets/pki.millegrilles.web.key
    hostname: coupdoeil.maple.millegrilles.mdugre.info
    image: registry.maple.mdugre.info:5000/coupdoeil_react.x86_64:1.5.0
    networks:
      mg_net: null
    ports:
    - published: 8443
      target: 443
    secrets:
    - source: pki.millegrilles.ssl.key
    - source: pki.millegrilles.ssl.cert
    - source: pki.millegrilles.ssl.CAchain
    - source: pki.millegrilles.web.fullchain
    - source: pki.millegrilles.web.key
version: '3.7'

